<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>创意生产任务管理</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- 筛选项区域 -->
        <div class="filter-section">
            <h3>2、筛选项</h3>
            <div class="filter-row">
                <div class="filter-item">
                    <label>创建时间</label>
                    <div class="time-range">
                        <input type="datetime-local" id="startTime" placeholder="开始时间">
                        <span class="time-separator">至</span>
                        <input type="datetime-local" id="endTime" placeholder="结束时间">
                    </div>
                </div>
                <div class="filter-item">
                    <label>提单人</label>
                    <input type="text" placeholder="请输入提单人手机号">
                </div>
                <div class="filter-item">
                    <label>设计师</label>
                    <select>
                        <option value="">请选择设计师</option>
                        <option value="AIGC">AIGC</option>
                        <option value="ued">ued</option>
                        <option value="OA">OA</option>
                    </select>
                </div>
                <div class="filter-item">
                    <label>创意状态</label>
                    <select>
                        <option value="">请选择创意状态</option>
                        <option value="pending">首次待生成</option>
                        <option value="generating">首次生成中</option>
                        <option value="completed">首次生成完成</option>
                        <option value="failed">首次生成失败</option>
                        <option value="re-pending">重新待生成</option>
                        <option value="re-generating">重新生成中</option>
                        <option value="re-completed">重新生成完成</option>
                        <option value="re-failed">重新生成失败</option>
                    </select>
                </div>
            </div>
            <div class="filter-row">
                <div class="filter-item">
                    <label>生成ID</label>
                    <input type="text" placeholder="请输入生成ID">
                </div>
                <div class="filter-item">
                    <label>生成类型</label>
                    <select>
                        <option value="">请选择生成类型</option>
                        <option value="type1">类型1</option>
                        <option value="type2">类型2</option>
                    </select>
                </div>
                <div class="filter-item">
                    <label>渠道</label>
                    <select>
                        <option value="">请选择渠道</option>
                        <option value="douyin">抖音</option>
                        <option value="xiaohongshu">小红书</option>
                        <option value="wechat">微信</option>
                        <option value="vtd">VTD</option>
                    </select>
                </div>
                <div class="filter-item">
                    <label>商品ID</label>
                    <input type="text" placeholder="请输入商品ID">
                </div>
            </div>
            <div class="filter-row">
                <div class="filter-item">
                    <label>应用场景</label>
                    <select>
                        <option value="">请选择应用场景</option>
                        <option value="daily">日常</option>
                        <option value="promotion">促销</option>
                        <option value="festival">节日</option>
                    </select>
                </div>
                <div class="filter-item">
                    <label>商品一级品类</label>
                    <select>
                        <option value="">请选择商品一级品类</option>
                        <option value="clothing">服装</option>
                        <option value="shoes">鞋靴</option>
                        <option value="bags">箱包</option>
                        <option value="accessories">配饰</option>
                        <option value="beauty">美妆</option>
                        <option value="digital">数码</option>
                        <option value="home">家居</option>
                        <option value="food">食品</option>
                    </select>
                </div>
                <div class="filter-item">
                    <label>是否已分配设计师</label>
                    <select>
                        <option value="">请选择分配状态</option>
                        <option value="assigned">已分配</option>
                        <option value="unassigned">未分配</option>
                    </select>
                </div>
                <div class="filter-item">
                    <label>期望交付时间</label>
                    <div class="time-range">
                        <input type="datetime-local" id="expectedStartTime" placeholder="开始时间">
                        <span class="time-separator">至</span>
                        <input type="datetime-local" id="expectedEndTime" placeholder="结束时间">
                    </div>
                </div>
            </div>
            <div class="filter-row">
                <div class="filter-item">
                    <label>创意策略标签</label>
                    <div class="multi-select-dropdown" id="creativeStrategyDropdown">
                        <div class="dropdown-header" onclick="toggleCreativeStrategyDropdown()">
                            <span class="selected-text">请选择创意策略标签</span>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="dropdown-content" id="creativeStrategyContent" style="display: none;">
                            <div class="dropdown-section">
                                <div class="section-title">素材样式</div>
                                <div class="section-options">
                                    <label><input type="checkbox" value="横图"> 横图</label>
                                    <label><input type="checkbox" value="竖图"> 竖图</label>
                                    <label><input type="checkbox" value="单图"> 单图</label>
                                    <label><input type="checkbox" value="多图6"> 多图6</label>
                                    <label><input type="checkbox" value="多图3"> 多图3</label>
                                    <label><input type="checkbox" value="多图4"> 多图4</label>
                                    <label><input type="checkbox" value="橱图"> 橱图</label>
                                    <label><input type="checkbox" value="抖音图文"> 抖音图文</label>
                                    <label><input type="checkbox" value="多图9"> 多图9</label>
                                    <label><input type="checkbox" value="商品方图"> 商品方图</label>
                                    <label><input type="checkbox" value="开屏"> 开屏</label>
                                    <label><input type="checkbox" value="多图"> 多图</label>
                                    <label><input type="checkbox" value="组图"> 组图</label>
                                </div>
                            </div>
                            <div class="dropdown-section">
                                <div class="section-title">商品框个数</div>
                                <div class="section-options">
                                    <label><input type="checkbox" value="单框"> 单框</label>
                                    <label><input type="checkbox" value="双框"> 双框</label>
                                    <label><input type="checkbox" value="三框"> 三框</label>
                                    <label><input type="checkbox" value="四框"> 四框</label>
                                    <label><input type="checkbox" value="六框"> 六框</label>
                                    <label><input type="checkbox" value="九框"> 九框</label>
                                    <label><input type="checkbox" value="无框"> 无框</label>
                                </div>
                            </div>
                            <div class="dropdown-section">
                                <div class="section-title">商品框形状</div>
                                <div class="section-options">
                                    <label><input type="checkbox" value="方形"> 方形</label>
                                    <label><input type="checkbox" value="圆形"> 圆形</label>
                                    <label><input type="checkbox" value="异形"> 异形</label>
                                    <label><input type="checkbox" value="圆角矩形"> 圆角矩形</label>
                                    <label><input type="checkbox" value="无"> 无</label>
                                </div>
                            </div>
                            <div class="dropdown-section">
                                <div class="section-title">商品展示</div>
                                <div class="section-options">
                                    <label><input type="checkbox" value="抠图商品"> 抠图商品</label>
                                    <label><input type="checkbox" value="场景图"> 场景图</label>
                                    <label><input type="checkbox" value="商品特写"> 商品特写</label>
                                    <label><input type="checkbox" value="白底图"> 白底图</label>
                                    <label><input type="checkbox" value="模板图"> 模板图</label>
                                    <label><input type="checkbox" value="原生图"> 原生图</label>
                                    <label><input type="checkbox" value="实拍图"> 实拍图</label>
                                    <label><input type="checkbox" value="纯色模特图"> 纯色模特图</label>
                                    <label><input type="checkbox" value="纯色商品图"> 纯色商品图</label>
                                    <label><input type="checkbox" value="场景模特图"> 场景模特图</label>
                                    <label><input type="checkbox" value="场景商品图"> 场景商品图</label>
                                </div>
                            </div>
                            <div class="dropdown-section">
                                <div class="section-title">色调</div>
                                <div class="section-options">
                                    <label><input type="checkbox" value="唯品红"> 唯品红</label>
                                    <label><input type="checkbox" value="蓝色"> 蓝色</label>
                                    <label><input type="checkbox" value="黄色"> 黄色</label>
                                    <label><input type="checkbox" value="绿色"> 绿色</label>
                                    <label><input type="checkbox" value="紫色"> 紫色</label>
                                </div>
                            </div>
                            <div class="dropdown-footer">
                                <button class="btn btn-primary btn-sm" onclick="applyCreativeStrategyFilter()">确定</button>
                                <button class="btn btn-secondary btn-sm" onclick="clearCreativeStrategyFilter()">清除</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="filter-item">
                    <label></label>
                    <div class="filter-buttons">
                        <button class="btn btn-primary" onclick="queryData()">查询</button>
                        <button class="btn btn-secondary" onclick="resetFilters()">重置</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 列表区域 -->
        <div class="list-section">
            <h3>1、列表字段</h3>
            <div class="list-header">
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="selectAll" onchange="toggleSelectAll()">
                    <label for="selectAll">全选</label>
                </div>
                <div class="header-actions">
                    <button class="btn btn-secondary" onclick="toggleColumnConfig()">
                        <i class="fas fa-columns"></i> 列设置
                    </button>
                    <div class="bulk-actions" id="bulkActions" style="display: none;">
                        <button class="btn btn-primary" onclick="assignDesigner()">分配设计师</button>
                        <button class="btn btn-success" onclick="exportTasks()">导出任务</button>
                        <button class="btn btn-info" onclick="openBulkUpload()">批量上传</button>
                    </div>
                </div>
            </div>
            
    <!-- 列配置面板 -->
    <div id="columnConfigPanel" class="column-config-panel" style="display: none;">
        <div class="column-config-header">
            <h4>列显示设置</h4>
            <button class="btn btn-sm btn-secondary" onclick="toggleColumnConfig()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="column-config-content">
            <div class="column-config-actions">
                <button class="btn btn-sm btn-primary" onclick="showAllColumns()">显示全部</button>
                <button class="btn btn-sm btn-secondary" onclick="hideAllColumns()">隐藏全部</button>
                <button class="btn btn-sm btn-success" onclick="resetColumnConfig()">重置默认</button>
            </div>
            <div class="column-list" id="columnList">
                <!-- 列配置项将通过JavaScript动态生成 -->
            </div>
        </div>
    </div>

    <!-- 设计师工时统计浮窗 -->
    <div id="designerStatsPanel" class="designer-stats-panel">
        <div class="designer-stats-toggle" onclick="toggleDesignerStats()">
            <i class="fas fa-chart-bar"></i>
            <span class="toggle-text">设计师工时</span>
        </div>
        <div class="designer-stats-content" id="designerStatsContent">
            <div class="designer-stats-header">
                <h4>设计师工时统计</h4>
                <button class="btn btn-sm btn-secondary" onclick="toggleDesignerStats()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="designer-stats-body">
                <div class="stats-summary">
                    <div class="summary-item">
                        <span class="summary-label">总工时:</span>
                        <span class="summary-value" id="totalHours">0h</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">设计师数:</span>
                        <span class="summary-value" id="designerCount">0</span>
                    </div>
                </div>
                <div class="designer-list" id="designerList">
                    <!-- 设计师列表将通过JavaScript动态生成 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 批量上传弹窗 -->
    <div id="bulkUploadModal" class="modal">
        <div class="modal-content bulk-upload-modal-content">
            <div class="modal-header">
                <h3>批量任务上传</h3>
                <span class="close" onclick="closeModal('bulkUploadModal')">&times;</span>
            </div>
            <div class="modal-body">
                <div class="bulk-upload-summary">
                    <div class="summary-info">
                        <span class="summary-text">已选择 <strong id="selectedTaskCount">0</strong> 个任务进行批量上传</span>
                        <div class="bulk-upload-actions">
                            <button class="btn btn-sm btn-success" onclick="confirmBulkUpload()" id="confirmUploadBtn" style="display: none;">
                                <i class="fas fa-check"></i> 确认上传
                            </button>
                            <button class="btn btn-sm btn-secondary" onclick="clearAllUploads()">清空所有上传</button>
                        </div>
                    </div>
                </div>
                <div class="bulk-upload-container">
                    <!-- 固定的上传区域 -->
                    <div class="bulk-upload-area-fixed" id="bulkUploadAreaFixed">
                        <div class="bulk-upload-zone" id="bulkUploadZone" 
                             ondragover="handleBulkDragOver(event)" 
                             ondragleave="handleBulkDragLeave(event)" 
                             ondrop="handleBulkDrop(event)"
                             onclick="triggerBulkFileInput()">
                            <div class="bulk-upload-content">
                                <i class="fas fa-cloud-upload-alt bulk-upload-icon"></i>
                                <h4>批量上传素材</h4>
                                <p>点击选择文件或拖拽文件到此处</p>
                                <p class="upload-hint">支持图片和视频文件，系统将根据文件名自动分配到对应任务</p>
                                <p class="upload-hint">文件名格式：任务ID_素材名称（如：7CrNkAAF_202509031.jpg）</p>
                                <button class="btn btn-primary" onclick="event.stopPropagation(); triggerBulkFileInput()">
                                    <i class="fas fa-upload"></i> 选择文件
                                </button>
                            </div>
                            <input type="file" id="bulkFileInput" 
                                   style="display: none;" 
                                   multiple 
                                   accept="image/*,video/*"
                                   onchange="handleBulkFileSelect(event)">
                        </div>
                        
                        <!-- 批量解析按钮 -->
                        <div class="bulk-parse-section" style="margin-top: 15px; text-align: center;">
                            <button class="btn btn-success" onclick="openBulkUploadBatchParseModal()" id="bulkParseBtn" style="display: none;">
                                <i class="fas fa-magic"></i> 批量解析标签
                            </button>
                        </div>
                    </div>
                    
                    <!-- 可滚动的表格区域 -->
                    <div class="bulk-upload-table-container">
                        <!-- 固定列区域 -->
                        <div class="fixed-columns-container">
                            <table class="bulk-upload-table fixed-columns-table">
                                <tbody id="bulkUploadTableBodyFixed">
                                    <!-- 固定列内容将通过JavaScript动态生成 -->
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- 可滚动列区域 -->
                        <div class="scrollable-columns-container">
                            <table class="bulk-upload-table scrollable-columns-table">
                                <tbody id="bulkUploadTableBodyScrollable">
                                    <!-- 可滚动列内容将通过JavaScript动态生成 -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- 素材标签展开面板 -->
                <div id="tagsExpansionPanel" class="tags-expansion-panel" style="display: none;">
                    <div class="tags-panel-header">
                        <h4 id="tagsPanelTitle">素材标签设置</h4>
                        <button class="btn btn-sm btn-secondary" onclick="closeTagsExpansion()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="tags-panel-body">
                        <div class="tags-table-container">
                            <table class="tags-table">
                                <thead>
                                    <tr>
                                        <th width="60">预览</th>
                                        <th width="150">素材名称</th>
                                        <th width="100">品类</th>
                                        <th width="100">渠道</th>
                                        <th width="100">设计师</th>
                                        <th width="120">商品ID</th>
                                        <th>文本标签</th>
                                    </tr>
                                </thead>
                                <tbody id="tagsTableBody">
                                    <!-- 标签表格内容将通过JavaScript动态生成 -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <div class="upload-progress" id="uploadProgress" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <span class="progress-text" id="progressText">上传中...</span>
                </div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="closeModal('bulkUploadModal')">取消</button>
                    <button class="btn btn-primary" onclick="confirmBulkUpload()" id="confirmBulkUploadBtn">
                        <i class="fas fa-upload"></i> 确认上传
                    </button>
                </div>
            </div>
        </div>
    </div>
            <div class="table-container">
                <table id="taskTable">
                    <thead>
                        <tr>
                            <!-- 表头将通过JavaScript动态生成 -->
                        </tr>
                    </thead>
                    <tbody id="taskTableBody">
                        <!-- 数据将通过JavaScript动态生成 -->
                    </tbody>
                </table>
            </div>
        </div>


    </div>

    <!-- 分配设计师弹窗 -->
    <div id="assignModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>分配设计师</h3>
                <span class="close" onclick="closeModal('assignModal')">&times;</span>
            </div>
            <div class="modal-body">
                <div id="assignmentEntries">
                    <div class="assignment-entry">
                        <div class="form-group">
                            <label>选择设计师OA</label>
                            <select class="designer-select">
                                <option value="">(下拉选项)</option>
                                <option value="AIGC">AIGC</option>
                                <option value="ued">ued</option>
                                <option value="OA001">OA001</option>
                                <option value="OA002">OA002</option>
                                <option value="OA003">OA003</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>分配素材数量</label>
                            <input type="number" class="material-quantity" value="1" min="1" readonly>
                        </div>
                    </div>
                </div>
                <div class="add-assignment">
                    <button class="btn btn-secondary" onclick="addAssignmentEntry()">
                        <i class="fas fa-plus"></i> 添加分配
                    </button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="confirmAssign()">确认</button>
                <button class="btn btn-secondary" onclick="closeModal('assignModal')">取消</button>
            </div>
        </div>
    </div>

    <!-- 上传素材弹窗 -->
    <div id="uploadModal" class="modal">
        <div class="modal-content upload-modal-content">
            <div class="modal-header">
                <h3>上传素材</h3>
                <span class="close" onclick="closeModal('uploadModal')">&times;</span>
            </div>
            <div class="modal-body">
                <!-- 上传区域 -->
                <div class="upload-area" id="uploadArea">
                    <div class="upload-zone" id="uploadZone">
                        <div class="upload-instructions">
                            <p>点击上传文件,最多支持20条素材(图片或视频)</p>
                            <p>支持上传图片JPG、PNG图片格式或者视频mp4格式</p>
                        </div>
                        <input type="file" id="materialFiles" multiple accept=".jpg,.jpeg,.png,.mp4" style="display: none;">
                    </div>
                </div>
                
                <!-- 素材配置区域 -->
                <div class="materials-config-wrapper" id="materialsConfigContainer" style="display: none;">
                    <!-- 顶部按钮区域 -->
                    <div class="materials-config-header">
                        <!-- 批量解析按钮 -->
                        <div class="batch-parse-section">
                            <button class="btn btn-primary" onclick="openBatchParseModal()">
                                <i class="fas fa-tags"></i> 批量素材解析
                            </button>
                        </div>
                        
                        <!-- 继续上传按钮 -->
                        <div class="continue-upload-section" id="continueUploadSection" style="display: none;">
                            <button class="btn btn-primary" onclick="showUploadArea()">
                                <i class="fas fa-plus"></i> 继续上传
                            </button>
                        </div>
                    </div>
                    
                    <!-- 素材配置容器 -->
                    <div class="materials-config-container">
                        <!-- 左侧导航列表 -->
                        <div class="material-nav-list" id="materialNavList">
                            <!-- 导航项将通过JavaScript动态生成 -->
                        </div>
                        
                        <!-- 右侧素材列表 -->
                        <div class="materials-list" id="materialsList">
                            <!-- 素材项将通过JavaScript动态生成 -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="confirmUpload()">确认上传</button>
                <button class="btn btn-secondary" onclick="closeModal('uploadModal')">取消</button>
            </div>
        </div>
    </div>

    <!-- 批量解析弹窗 -->
    <div id="batchParseModal" class="modal">
        <div class="modal-content batch-parse-modal-content">
            <div class="modal-header">
                <h3>批量素材解析</h3>
                <span class="close" onclick="closeModal('batchParseModal')">&times;</span>
            </div>
            <div class="modal-body">
                <div class="batch-parse-instructions">
                    <p>请将上传素材名称对应的二级标签复制到表格中，每列一个标签。系统将自动解析标签。</p>
                </div>
                <div class="batch-parse-table-container">
                    <table id="batchParseTable" class="batch-parse-table">
                        <thead>
                            <tr>
                                <th width="60">序号</th>
                                <th width="200">素材名称</th>
                                <th width="120">标签1</th>
                                <th width="120">标签2</th>
                                <th width="120">标签3</th>
                                <th width="120">标签4</th>
                                <th width="120">标签5</th>
                                <th width="120">标签6</th>
                            </tr>
                        </thead>
                        <tbody id="batchParseTableBody">
                            <!-- 表格内容将通过JavaScript动态生成 -->
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="parseBatchTags()">
                    <i class="fas fa-magic"></i> 解析
                </button>
                <button class="btn btn-secondary" onclick="closeModal('batchParseModal')">取消</button>
            </div>
        </div>
    </div>

    <!-- 批量上传批量解析弹窗 -->
    <div id="bulkUploadBatchParseModal" class="modal">
        <div class="modal-content batch-parse-modal-content">
            <div class="modal-header">
                <h3>批量标签解析</h3>
                <span class="close" onclick="closeModal('bulkUploadBatchParseModal')">&times;</span>
            </div>
            <div class="modal-body">
                <div class="batch-parse-instructions">
                    <p>请将素材对应的标签复制到表格中，每列一个标签。支持从Excel等表格软件直接复制粘贴。</p>
                    <p class="text-muted">提示：可以直接从Excel复制多行数据，系统会自动解析并填充到对应的标签列中。</p>
                </div>
                <div class="batch-parse-table-container">
                    <table id="bulkUploadBatchParseTable" class="batch-parse-table">
                        <thead>
                            <tr>
                                <th width="60">序号</th>
                                <th width="200">素材名称</th>
                                <th width="120">标签1</th>
                                <th width="120">标签2</th>
                                <th width="120">标签3</th>
                                <th width="120">标签4</th>
                                <th width="120">标签5</th>
                                <th width="120">标签6</th>
                                <th width="120">标签7</th>
                                <th width="120">标签8</th>
                                <th width="120">标签9</th>
                                <th width="120">标签10</th>
                            </tr>
                        </thead>
                        <tbody id="bulkUploadBatchParseTableBody">
                            <!-- 动态生成 -->
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="parseBulkUploadBatchTags()">
                    <i class="fas fa-magic"></i> 解析标签
                </button>
                <button class="btn btn-secondary" onclick="closeModal('bulkUploadBatchParseModal')">取消</button>
            </div>
        </div>
    </div>

    <!-- 参考图弹窗 -->
    <div id="referenceModal" class="modal">
        <div class="modal-content reference-modal-content">
            <div class="modal-header">
                <h3>参考图查看</h3>
                <span class="close" onclick="closeModal('referenceModal')">&times;</span>
            </div>
            <div class="modal-body">
                <div class="reference-image-container">
                    <img id="referenceImage" src="" alt="参考图" style="max-width: 100%; max-height: 70vh; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                </div>
                <div class="reference-info">
                    <p><strong>参考图编号：</strong><span id="referenceNumber"></span></p>
                    <p><strong>图片地址：</strong><span id="referenceUrl"></span></p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="openImageInNewTab()">
                    <i class="fas fa-external-link-alt"></i> 在新标签页打开
                </button>
                <button class="btn btn-secondary" onclick="closeModal('referenceModal')">关闭</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
